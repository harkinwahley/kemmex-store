<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KEMMEX STORE | Online Shopping for Fashion</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/png" href="https://img.icons8.com/color/48/shop-local.png">
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        jumia: { orange: '#1e40af', hover: '#1e3a8a', dark: '#282828', gray: '#f1f1f2' }
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #f1f1f2; font-family: 'Roboto', sans-serif; }
        .whatsapp-float {
            position: fixed; bottom: 20px; right: 20px;
            background-color: #25d366; color: white;
            border-radius: 50px; width: 60px; height: 60px;
            display: flex; align-items: center; justify-content: center;
            font-size: 30px; z-index: 100; box-shadow: 2px 2px 10px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body class="text-jumia-dark">

    <a href="https://wa.me/2348039468706?text=Hello%20Kemmex%20Store" target="_blank" class="whatsapp-float">
        <i class="fab fa-whatsapp"></i>
    </a>

    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <a href="index.html" class="text-2xl font-bold">KEMMEX<span class="text-jumia-orange">★</span></a>
            <div class="flex items-center gap-4">
                <div onclick="toggleCart()" class="relative cursor-pointer">
                    <i class="fas fa-shopping-cart text-xl"></i>
                    <span id="cartCount" class="absolute -top-2 -right-2 bg-jumia-orange text-white text-[10px] px-1.5 rounded-full">0</span>
                </div>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-6 flex flex-col md:flex-row gap-6">
        <aside class="hidden md:block w-1/4 bg-white p-4 rounded shadow-sm h-fit">
            <h3 class="font-bold border-b pb-2 mb-2 uppercase text-xs text-gray-500">Categories</h3>
            <ul class="space-y-2 text-sm">
                <li><button onclick="filterCategory('all')" class="hover:text-jumia-orange">All Products</button></li>
                <li><button onclick="filterCategory('Baby & Kids')" class="hover:text-jumia-orange">Baby & Kids</button></li>
                <li><button onclick="filterCategory('Maternity')" class="hover:text-jumia-orange">Maternity</button></li>
                <li><button onclick="filterCategory('Thrift Wears')" class="hover:text-jumia-orange">Thrift Wears</button></li>
            </ul>
        </aside>

        <div id="products-grid" class="flex-grow grid grid-cols-2 lg:grid-cols-4 gap-4">
            </div>
    </main>

    <div id="cartSidebar" class="fixed inset-0 bg-black/50 z-50 hidden justify-end">
        <div class="bg-white w-full max-w-md h-full flex flex-col">
            <div class="p-4 border-b flex justify-between items-center">
                <h3 class="font-bold">Your Cart</h3>
                <button onclick="toggleCart()" class="text-2xl">&times;</button>
            </div>
            <div id="cart-items" class="flex-grow p-4 overflow-y-auto space-y-4"></div>
            <div class="p-4 border-t bg-gray-50">
                <div class="flex justify-between mb-4 font-bold text-lg">
                    <span>Subtotal:</span>
                    <span id="cart-total">₦0</span>
                </div>
                <button onclick="openCheckout()" class="w-full bg-jumia-orange text-white py-3 rounded font-bold">PROCEED TO CHECKOUT</button>
            </div>
        </div>
    </div>

    <div id="checkoutModal" class="fixed inset-0 bg-black/60 z-[60] hidden justify-center items-center p-4">
        <div class="bg-white rounded-lg w-full max-w-lg p-6 relative">
            <button onclick="closeModal()" class="absolute top-3 right-3 text-2xl">&times;</button>
            <h2 class="text-xl font-bold mb-4">Delivery & Payment</h2>
            <form onsubmit="handleOrderSubmission(event)" class="space-y-4">
                <input id="custName" type="text" placeholder="Full Name" required class="w-full border p-2 rounded">
                <input id="custPhone" type="tel" placeholder="WhatsApp Number" required class="w-full border p-2 rounded">
                <textarea id="custAddress" placeholder="Full Delivery Address" required class="w-full border p-2 rounded"></textarea>
                
                <select id="deliveryLoc" onchange="calculateFinalTotal()" class="w-full border p-2 rounded">
                    <option value="0">Store Pickup (Abeokuta) - Free</option>
                    <option value="1000">Within Ogun State - ₦1,000</option>
                    <option value="3000">Outside Ogun State - ₦3,000</option>
                </select>

                <div class="bg-blue-50 p-4 rounded border text-sm">
                    <p class="mb-1">Pay to: <strong>Opay | 8039468706 | Sokunbi Oluwakemi</strong></p>
                    <div class="flex justify-between font-bold text-lg mt-2">
                        <span>Total:</span>
                        <span id="final-total">₦0</span>
                    </div>
                </div>
                <button type="submit" id="submitBtn" class="w-full bg-green-600 text-white py-3 rounded font-bold uppercase">Confirm & Send Order</button>
            </form>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBizDI5d10EjKw3TREi84gvmsC5uGcRxh8",
            authDomain: "kemmex-store-9ffa3.firebaseapp.com",
            projectId: "kemmex-store-9ffa3",
            storageBucket: "kemmex-store-9ffa3.appspot.com",
            appId: "1:500875032118:web:f1d3b9b9d6351bc7130a97"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let cart = JSON.parse(localStorage.getItem('kemmex_cart')) || [];
        let currentCategory = 'all';

        function loadProducts() {
            let query = db.collection("products").where("active", "==", true);
            if(currentCategory !== 'all') query = query.where("category", "==", currentCategory);

            query.onSnapshot(snapshot => {
                const grid = document.getElementById('products-grid');
                grid.innerHTML = '';
                snapshot.forEach(doc => {
                    const p = doc.data();
                    grid.innerHTML += `
                        <div class="bg-white p-3 rounded shadow-sm border group">
                            <div class="relative overflow-hidden">
                                <img src="${p.img}" class="w-full h-44 object-cover rounded mb-2 group-hover:scale-105 transition">
                            </div>
                            <h3 class="text-xs font-medium truncate">${p.name}</h3>
                            <p class="text-jumia-orange font-bold">₦${p.price.toLocaleString()}</p>
                            <div class="flex gap-2 mt-2">
                                <button onclick="addToCart('${doc.id}', '${p.name}', ${p.price}, '${p.img}')" class="flex-grow bg-jumia-orange text-white text-[10px] py-2 rounded font-bold">ADD TO CART</button>
                                <button onclick="enquire('${p.name}', ${p.price})" class="bg-green-500 text-white px-3 py-2 rounded">
                                    <i class="fab fa-whatsapp"></i>
                                </button>
                            </div>
                        </div>`;
                });
            });
        }

        function handleOrderSubmission(e) {
            e.preventDefault();
            const btn = document.getElementById('submitBtn');
            btn.disabled = true;
            btn.innerText = "Processing...";

            const name = document.getElementById('custName').value;
            const phone = document.getElementById('custPhone').value;
            const address = document.getElementById('custAddress').value;
            const shipping = Number(document.getElementById('deliveryLoc').value);
            let subtotal = cart.reduce((s, i) => s + (i.price * i.qty), 0);

            const orderData = {
                customer: { name, phone, address, state: document.getElementById('deliveryLoc').options[document.getElementById('deliveryLoc').selectedIndex].text },
                items: cart,
                totalAmount: subtotal + shipping,
                shipping: shipping,
                status: "Pending",
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            // 1. Save to Firestore for your Admin Panel
            db.collection("orders").add(orderData).then(() => {
                // 2. Format for WhatsApp
                let itemText = "";
                cart.forEach((item, i) => {
                    itemText += `${i+1}. *${item.name}* (x${item.qty}) - ₦${(item.price * item.qty).toLocaleString()}%0A`;
                });

                const msg = `*NEW ORDER - KEMMEX STORE*%0A---------------------------%0A*Name:* ${name}%0A*Address:* ${address}%0A---------------------------%0A*Items:*%0A${itemText}%0A*Shipping:* ₦${shipping.toLocaleString()}%0A*TOTAL:* ₦${(subtotal + shipping).toLocaleString()}%0A---------------------------%0A_Payment confirmation follows._`;
                
                window.open(`https://wa.me/2348039468706?text=${msg}`, '_blank');
                
                // Clear Cart
                cart = [];
                localStorage.removeItem('kemmex_cart');
                location.reload();
            });
        }

        function addToCart(id, name, price, img) {
            const idx = cart.findIndex(i => i.id === id);
            if(idx > -1) cart[idx].qty++;
            else cart.push({id, name, price, img, qty: 1});
            saveCart();
            alert("Added to cart!");
        }

        function saveCart() {
            localStorage.setItem('kemmex_cart', JSON.stringify(cart));
            updateCartUI();
        }

        function updateCartUI() {
            const list = document.getElementById('cart-items');
            const totalEl = document.getElementById('cart-total');
            document.getElementById('cartCount').innerText = cart.reduce((s, i) => s + i.qty, 0);
            
            let total = 0;
            list.innerHTML = cart.map(item => {
                total += (item.price * item.qty);
                return `<div class="flex items-center gap-3 border-b pb-2">
                    <img src="${item.img}" class="w-12 h-12 object-cover rounded">
                    <div class="flex-grow">
                        <p class="text-xs font-bold">${item.name}</p>
                        <p class="text-xs text-gray-500">${item.qty} x ₦${item.price.toLocaleString()}</p>
                    </div>
                </div>`;
            }).join('');
            totalEl.innerText = `₦${total.toLocaleString()}`;
        }

        function calculateFinalTotal() {
            let subtotal = cart.reduce((s, i) => s + (i.price * i.qty), 0);
            let shipping = Number(document.getElementById('deliveryLoc').value);
            document.getElementById('final-total').innerText = `₦${(subtotal + shipping).toLocaleString()}`;
        }

        function filterCategory(cat) { currentCategory = cat; loadProducts(); }
        function enquire(name, price) { window.open(`https://wa.me/2348039468706?text=Hi,%20is%20${name}%20(₦${price})%20available?`, '_blank'); }
        function toggleCart() { document.getElementById('cartSidebar').classList.toggle('hidden'); document.getElementById('cartSidebar').classList.toggle('flex'); }
        function openCheckout() { if(cart.length === 0) return; toggleCart(); document.getElementById('checkoutModal').classList.remove('hidden'); document.getElementById('checkoutModal').classList.add('flex'); calculateFinalTotal(); }
        function closeModal() { document.getElementById('checkoutModal').classList.add('hidden'); }

        window.onload = () => { loadProducts(); updateCartUI(); };
    </script>
</body>
</html>
