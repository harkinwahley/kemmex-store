<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Orders | Kemmex Store</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body class="bg-gray-100 p-4 font-sans">
<header class="max-w-3xl mx-auto mb-6 flex justify-between items-center">
    <h1 class="text-2xl font-bold">My Orders</h1>
    <a href="index.html" class="text-orange-500 font-bold hover:underline">Back to Store</a>
</header>
<main class="max-w-3xl mx-auto" id="ordersList"><p class="text-center text-gray-500">Loading...</p></main>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBizDI5d10EjKw3TREi84gvmsC5uGcRxh8",
    authDomain: "kemmex-store-9ffa3.firebaseapp.com",
    projectId: "kemmex-store-9ffa3",
    storageBucket: "kemmex-store-9ffa3.firebasestorage.app",
    messagingSenderId: "500875032118",
    appId: "1:500875032118:web:f1d3b9b9d6351bc7130a97"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  auth.onAuthStateChanged(user => {
    if (!user) { alert("Please login to view your orders"); window.location.href = "index.html"; return; }
    db.collection("orders").where("userId", "==", user.uid).orderBy("createdAt", "desc").onSnapshot(snapshot => {
      const container = document.getElementById("ordersList");
      if (snapshot.empty) { container.innerHTML = "<p class='text-center text-gray-500'>No orders yet.</p>"; return; }
      container.innerHTML = snapshot.docs.map(doc => {
        const o = doc.data();
        const date = o.createdAt ? new Date(o.createdAt.seconds * 1000).toLocaleDateString() : 'Just now';
        return `
          <div class="bg-white p-4 rounded shadow mb-4">
            <div class="flex justify-between border-b pb-2 mb-2">
                <span class="font-bold text-gray-600">${date}</span>
                <span class="font-bold uppercase text-blue-600">${o.status}</span>
            </div>
            <div class="text-sm text-gray-700 mb-3">
                ${o.items.map(i => `<div class="flex justify-between"><span>${i.qty}x ${i.name}</span><span>₦${i.price}</span></div>`).join('')}
            </div>
            <div class="flex justify-between border-t pt-2 font-bold text-lg">
                <span>Total</span>
                <span class="text-orange-500">₦${o.totalAmount.toLocaleString()}</span>
            </div>
          </div>
        `;
      }).join("");
    });
  });
</script>
</body>
</html>
