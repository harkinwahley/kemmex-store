<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | Kemmex Store</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/png" href="https://img.icons8.com/color/48/shop-local.png">

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        kemmex: { blue: '#1e40af', orange: '#f68b1e', dark: '#111827' }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 font-sans min-h-screen">

    <header class="bg-kemmex-dark shadow-md sticky top-0 z-50 text-white">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <h1 class="text-xl font-black tracking-tighter">KEMMEX<span class="text-kemmex-orange">ADMIN</span></h1>
            <div class="flex items-center gap-4">
                <a href="index.html" class="text-xs font-bold uppercase tracking-widest text-gray-400 hover:text-white">View Store</a>
                <button onclick="logout()" class="text-xs font-bold bg-red-600 px-4 py-2 rounded-lg hover:bg-red-700 transition">Logout</button>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8 max-w-6xl">
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                <h3 class="text-gray-400 text-[10px] font-black uppercase tracking-widest mb-1">Total Sales Record</h3>
                <p id="total-orders" class="text-4xl font-black text-kemmex-dark">...</p>
            </div>
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                <h3 class="text-gray-400 text-[10px] font-black uppercase tracking-widest mb-1">Active Inventory</h3>
                <p id="total-products" class="text-4xl font-black text-kemmex-blue">...</p>
            </div>
            <a href="add-product.html" class="bg-kemmex-orange text-white p-6 rounded-2xl shadow-lg hover:shadow-orange-200 flex items-center justify-between transition group">
                <div>
                    <span class="text-[10px] font-black uppercase tracking-widest opacity-80">Quick Action</span>
                    <p class="text-xl font-black">Add Product</p>
                </div>
                <i class="fas fa-plus-circle text-3xl group-hover:rotate-90 transition-transform"></i>
            </a>
        </div>

        <div class="flex gap-8 mb-8 border-b border-gray-200">
            <button onclick="switchTab('orders')" id="tab-orders" class="pb-4 font-black uppercase text-xs tracking-widest border-b-2 border-kemmex-blue text-kemmex-blue">Orders Management</button>
            <button onclick="switchTab('inventory')" id="tab-inventory" class="pb-4 font-black uppercase text-xs tracking-widest text-gray-400 hover:text-kemmex-dark">Product Inventory</button>
        </div>

        <div id="section-orders">
            <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                <h2 class="text-xl font-black text-kemmex-dark">Incoming Orders</h2>
                <select id="orderFilter" onchange="renderOrders()" class="bg-white border border-gray-200 rounded-xl px-4 py-2 font-bold text-sm outline-none focus:ring-2 focus:ring-kemmex-blue">
                    <option value="active">âš¡ Needs Attention</option>
                    <option value="history">âœ… Completed / Cancelled</option>
                    <option value="all">ðŸ“‹ All Time</option>
                </select>
            </div>

            <div id="orders-list" class="space-y-6">
                <div class="text-center py-20"><i class="fas fa-spinner fa-spin text-3xl text-kemmex-blue"></i></div>
            </div>
        </div>

        <div id="section-inventory" class="hidden">
            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                <table class="w-full text-left">
                    <thead class="bg-gray-50 border-b border-gray-100 text-[10px] font-black uppercase text-gray-400">
                        <tr>
                            <th class="p-4">Item</th>
                            <th class="p-4">Category</th>
                            <th class="p-4">Price</th>
                            <th class="p-4">Stock</th>
                            <th class="p-4 text-right">Edit</th>
                        </tr>
                    </thead>
                    <tbody id="inventory-list" class="divide-y divide-gray-50"></tbody>
                </table>
            </div>
        </div>
    </main>

    <div id="editModal" class="fixed inset-0 bg-kemmex-dark/80 z-[60] hidden justify-center items-center backdrop-blur-sm p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg p-8 relative max-h-[90vh] overflow-y-auto">
            <button onclick="closeEditModal()" class="absolute top-4 right-4 text-gray-400 hover:text-black text-2xl">&times;</button>
            <h2 class="text-2xl font-black mb-6 text-kemmex-dark">Update Product</h2>
            <form id="editForm" onsubmit="saveProductChanges(event)" class="space-y-4">
                <input type="hidden" id="editId">
                <div class="grid grid-cols-1 gap-4">
                    <div>
                        <label class="text-[10px] font-black uppercase text-gray-400 tracking-widest">Product Name</label>
                        <input type="text" id="editName" class="w-full border-b-2 border-gray-100 focus:border-kemmex-blue py-2 outline-none font-bold">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-[10px] font-black uppercase text-gray-400 tracking-widest">Price (â‚¦)</label>
                            <input type="number" id="editPrice" class="w-full border-b-2 border-gray-100 focus:border-kemmex-blue py-2 outline-none font-bold">
                        </div>
                        <div>
                            <label class="text-[10px] font-black uppercase text-gray-400 tracking-widest">Stock Level</label>
                            <input type="number" id="editStock" class="w-full border-b-2 border-gray-100 focus:border-kemmex-blue py-2 outline-none font-bold">
                        </div>
                    </div>
                    </div>
                <button type="submit" id="updateBtn" class="w-full bg-kemmex-blue text-white font-black py-4 rounded-xl mt-6 shadow-lg">Save Changes</button>
            </form>
        </div>
    </div>

    <script>
        // CONFIG & AUTH (Keep your same Firebase logic here)
        const ADMIN_EMAILS = ["aakinwale16@gmail.com", "kemzolin99@gmail.com"];
        const firebaseConfig = {
            apiKey: "AIzaSyBizDI5d10EjKw3TREi84gvmsC5uGcRxh8",
            authDomain: "kemmex-store-9ffa3.firebaseapp.com",
            projectId: "kemmex-store-9ffa3",
            storageBucket: "kemmex-store-9ffa3.appspot.com",
            appId: "1:500875032118:web:f1d3b9b9d6351bc7130a97"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        let allOrdersData = [];
        let inventoryData = {};

        auth.onAuthStateChanged(user => {
            if (user && ADMIN_EMAILS.includes(user.email)) {
                loadOrders(); 
                loadInventory();
            } else {
                window.location.href = "index.html";
            }
        });

        function switchTab(tab) {
            document.getElementById('section-orders').classList.toggle('hidden', tab !== 'orders');
            document.getElementById('section-inventory').classList.toggle('hidden', tab !== 'inventory');
            
            const btnOrders = document.getElementById('tab-orders');
            const btnInv = document.getElementById('tab-inventory');
            
            if(tab === 'orders') {
                btnOrders.className = "pb-4 font-black uppercase text-xs tracking-widest border-b-2 border-kemmex-blue text-kemmex-blue";
                btnInv.className = "pb-4 font-black uppercase text-xs tracking-widest text-gray-400 hover:text-kemmex-dark";
            } else {
                btnInv.className = "pb-4 font-black uppercase text-xs tracking-widest border-b-2 border-kemmex-blue text-kemmex-blue";
                btnOrders.className = "pb-4 font-black uppercase text-xs tracking-widest text-gray-400 hover:text-kemmex-dark";
            }
        }

        function loadOrders() {
            db.collection("orders").onSnapshot(snapshot => {
                document.getElementById('total-orders').innerText = snapshot.size;
                allOrdersData = snapshot.docs.map(doc => ({id: doc.id, ...doc.data()}));
                allOrdersData.sort((a,b) => (b.createdAt?.toDate() || 0) - (a.createdAt?.toDate() || 0));
                renderOrders();
            });
        }

        function renderOrders() {
            const filter = document.getElementById('orderFilter').value;
            const list = document.getElementById('orders-list');
            
            const filtered = allOrdersData.filter(o => {
                const s = o.status || "Pending";
                if (filter === 'active') return s !== 'Delivered' && s !== 'Cancelled';
                if (filter === 'history') return s === 'Delivered' || s === 'Cancelled';
                return true;
            });

            list.innerHTML = filtered.map(o => `
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                    <div class="p-6 border-b border-gray-50 flex justify-between items-center bg-gray-50/50">
                        <div>
                            <span class="text-[10px] font-black text-gray-400 uppercase tracking-tighter">Order ID</span>
                            <h4 class="font-black text-kemmex-dark">#${o.id.slice(0,8)}</h4>
                        </div>
                        <div class="flex items-center gap-2">
                            <select id="status-${o.id}" class="text-xs font-black uppercase border rounded-lg px-2 py-1 outline-none">
                                <option value="Pending" ${o.status==='Pending'?'selected':''}>Pending</option>
                                <option value="Confirmed" ${o.status==='Confirmed'?'selected':''}>Confirmed</option>
                                <option value="Shipped" ${o.status==='Shipped'?'selected':''}>Shipped</option>
                                <option value="Delivered" ${o.status==='Delivered'?'selected':''}>Delivered</option>
                                <option value="Cancelled" ${o.status==='Cancelled'?'selected':''}>Cancelled</option>
                            </select>
                            <button onclick="updateOrderStatus('${o.id}')" class="bg-kemmex-blue text-white p-2 rounded-lg text-xs"><i class="fas fa-save"></i></button>
                        </div>
                    </div>
                    <div class="p-6 grid md:grid-cols-2 gap-8">
                        <div>
                            <p class="text-[10px] font-black text-gray-400 uppercase mb-2">Customer</p>
                            <p class="font-bold text-sm">${o.customer.firstName} ${o.customer.lastName}</p>
                            <p class="text-xs text-gray-500">${o.customer.address}, ${o.customer.state}</p>
                            <a href="https://wa.me/234${o.customer.phone.substring(1)}" target="_blank" class="mt-4 inline-block text-green-600 font-bold text-xs uppercase border border-green-200 px-4 py-2 rounded-lg hover:bg-green-50">
                                <i class="fab fa-whatsapp"></i> Chat Customer
                            </a>
                        </div>
                        <div>
                            <p class="text-[10px] font-black text-gray-400 uppercase mb-2">Summary</p>
                            <p class="text-xl font-black text-kemmex-blue">â‚¦${(o.totalAmount || 0).toLocaleString()}</p>
                            <p class="text-[10px] text-gray-400">${(o.items || []).length} Items</p>
                        </div>
                    </div>
                </div>
            `).join('') || `<div class="text-center py-10 text-gray-400">No orders found here.</div>`;
        }

        // Add the rest of your updateOrderStatus, loadInventory, and editModal functions below
        // ... (Same as your previous version but update styles to match the new UI)

        function logout() { auth.signOut().then(() => window.location.href = "index.html"); }
    </script>
</body>
</html>
